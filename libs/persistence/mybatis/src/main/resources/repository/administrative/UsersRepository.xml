<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ru.michaelilyin.vsu.demo.repository.administrative.UsersRepository">

    <select id="getUserViews" resultType="ru.michaelilyin.vsu.demo.domain.administrative.UserView">
        <include refid="net.medvedmike.vsu.demo.repository.commonSql.pageSupportBegin"/>
        <![CDATA[
        SELECT
          id as id,
          name as name,
          surname as surname,
          login as login,
          email as email,
          birthday as birthday
        FROM users
        WHERE
          (#{login}::VARCHAR IS NULL OR UPPER(login) LIKE UPPER('%${login}%'))
          AND (#{name}::VARCHAR IS NULL OR UPPER(name) LIKE UPPER('%${name}%'))
          AND (#{surname}::VARCHAR IS NULL OR UPPER(surname) LIKE UPPER('%${surname}%'))
          AND (#{email}::VARCHAR IS NULL OR UPPER(email) LIKE UPPER('%${email}%'))
          AND (#{birthday}::DATE IS NULL OR DATE_TRUNC('days', #{birthday}::DATE) = DATE_TRUNC('days', birthday))
        ]]>
        <include refid="net.medvedmike.vsu.demo.repository.commonSql.orderBy"/>
        <include refid="net.medvedmike.vsu.demo.repository.commonSql.pageSupportEnd"/>
    </select>

    <select id="find" resultType="ru.michaelilyin.vsu.demo.domain.administrative.User">
        <![CDATA[
        SELECT
          id as id,
          name as name,
          surname as surname,
          login as login,
          email as email,
          birthday as birthday
        FROM users
        WHERE
          id = #{id}
        ]]>
    </select>

    <insert id="create" parameterType="ru.michaelilyin.vsu.demo.domain.administrative.User">
        <![CDATA[
        INSERT INTO users (login, name, surname, email, birthday)
        VALUES (#{login}, #{name}, #{surname}, #{email}, #{birthday})
        ]]>
        <selectKey keyColumn="id" keyProperty="id" order="AFTER" resultType="long">
            <![CDATA[
            SELECT currval('users_id_seq') as id
            ]]>
        </selectKey>
    </insert>

    <update id="update" parameterType="ru.michaelilyin.vsu.demo.domain.administrative.User">
        <![CDATA[
        UPDATE users
        SET
          login = #{login},
          name = #{name},
          surname = #{surname},
          email = #{email},
          birthday = #{birthday}
        WHERE
          id = #{id}
        ]]>
    </update>

    <delete id="delete" parameterType="long">
        <![CDATA[
        DELETE FROM users WHERE id IN
        ]]>
        <include refid="net.medvedmike.vsu.demo.repository.commonSql.inList"/>
    </delete>

</mapper>